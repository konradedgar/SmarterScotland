---
title: "Basic Usage"
author: "Konrad Zdeb"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Basic Usage}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  collapse = TRUE,
  comment = "#>"
)

# Enable httptest for vignette development
library(httptest)
start_vignette("basic-workflow")

# Load package
library("SmarterScotland")
```

# Introduction

The following packages makes use of the SPARQL [^1] language queries in order to query the data available through the [statistics.gov.scot](http://statistics.gov.scot) portal [^2]. In effect, the app works as a wrapper for SPARQL queries providing a suite of common functionalities relevant to how the Scottish public data is being utilises.

## Available Data

The package comes with an embedded data sets containing list of data and geographies available through the [statistics.gov.scot](http://statistics.gov.scot) endpoint. 

### [statistics.gov.scot](http://statistics.gov.scot) data sets

To see the list of available data sets refer to the `available_data_sets` objects.

```{r show_available_data}
data("available_data_sets")
```
```{r table_available_data, echo=FALSE}
knitr::kable(head(available_data_sets))
```

### Geographies

Similar techniques can be used to obtain a list of available geographies.

```{r show_available_geographies}
data("standard_geography_code_register")
```
```{r table_available_geographies, echo=FALSE}
knitr::kable(head(standard_geography_code_register))
```

### Live reference data

More recent versions of the provided data sets can be sourced live from the [statistics.gov.scot](http://statistics.gov.scot) portal using dedicated functions, `get_available_datasets` sources available data and `get_available_geographies` sources and parses Standard Geography Code Register. Searching for thematic data sets can be achieved simply using queries, as shown below. 

```{r search_jsa_data, results='hide'}
get_available_datasets(pattern = "pupil")
```
```{r search_jsa_data_results, echo=FALSE}
knitr::kable(get_available_datasets(pattern = "pupil"))
```

Additional information on the available data can be gathered by following the links returned in the data set above. For instance [http://statistics.gov.scot/data/pupil-attainment-asn](http://statistics.gov.scot/data/pupil-attainment-asn) points to *Pupil Attainment (English and Maths)* data set.

# Sourcing Geography Data

Likely, one of the most useful functions offered in the package would be concerned with sourcing data for specific geographies. Example below illustrates sourcing *Pupil Attainment (English and Maths)* data for geographies where official name or label matches *East Lothian*. 

```{r source_edinburgh_JSA}
dta_Edinburgh_JSA <- get_geography_data(data_set = "pupil-attainment-asn",
                                        geography = "East Lothian")
```
```{r show_edinburgh_JSA, echo=FALSE}
knitr::kable(head(dta_Edinburgh_JSA))
```

## Pre-processing

A convenience function providing mechanism to quickly remove initial elements of URI string. A preferred option is to retrieve **`rdfs:label`** [^3] of the class. Provided pre-processing function offers a quick alternative to manual processing and obtaining a data set without unnecessary variables and with correct variable types. The example below provides an example of the previous data to which `pre_process_data` function was applied.

```{r source_pre_process}
dta_Glsgow_Crime <- pre_process_data(dta_Edinburgh_JSA)
```
```{r show_Glasgow_Crime, echo=FALSE}
knitr::kable(head(dta_Glsgow_Crime))
```


```{r end-setup, include=FALSE}
end_vignette()
```

[^1]: Detailed information on the SPARQL is available through [W3C pages](https://www.w3.org/TR/rdf-sparql-query/).
[^2]: The implementation follows part of the *Open Data Strategy* implemented by the Scottish Government that can be accessed through the [Scottish Government pages](http://www.gov.scot/Topics/Economy/digital/digitalservices/datamanagement/OpenData).
[^3]: This is currently being developed; this behaviour will be controlled by `SmarterScotland.suffix_rdf` option.