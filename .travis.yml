language: r

cache:
  directories:
    - $TRAVIS_BUILD_DIR/packrat/src
    - $TRAVIS_BUILD_DIR/packrat/lib
  packages: true

sudo: true
fortran: false

addons:
  apt:
    packages:
      - libgs-dev
      - librdf0-dev
      - libv8-dev
      - libxml2-dev

r_github_packages:
  - jimhester/covr

matrix:
  fast_finish: true
  include:
    - r: 3.4
      warnings_are_errors: false
    - r: oldrel
      warnings_are_errors: false
    - r: release
      script:
        - R CMD check *tar.gz --as-cran
        - R CMD build . --no-build-vignettes --no-manual
        - PKG_TARBALL=$(ls -1t *.tar.gz | head -n 1)
        - echo "${PKG_TARBAL}"
      after_success: Rscript -e 'covr::codecov(type = "all")'
      before_deploy:
        - Rscript -e 'remotes::install_cran("pkgdown")'
      deploy:
        provider: script
        skip_cleanup: true
        keep_history: true
        local-dir: docs
        on:
          branches:
            only:
              - gh-pages
        script: Rscript -e 'pkgdown::deploy_site_github(verbose = TRUE)'
      warnings_are_errors: true
    - r: devel
      warnings_are_errors: false
    - os: osx
      r:  release
      warnings_are_errors: true
    - os: osx
      r:  oldrel
      warnings_are_errors: true
