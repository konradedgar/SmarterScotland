language: r

cache:
  directories:
    - $TRAVIS_BUILD_DIR/packrat/src
    - $TRAVIS_BUILD_DIR/packrat/lib
  packages: true

sudo: true

fortran: false

addons:
  apt:
    update: true
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - libgs-dev
      - qpdf
      - ghostscript
      - librdf0-dev
      - libv8-dev
      - libjq-dev
      - libdb-dev
      - libxml2-dev

r_binary_packages:
  - rmarkdown
  - tinytex
  - knitr
  - xml2
  - hunspell
  - V8

r_github_packages:
  - jimhester/covr
  - ropensci/jsonld  

matrix:
  include:
    - r: oldrel
      dist: bionic
      before_install:
        - sudo apt-get update
        - tlmgr install index
        - Rscript -e 'update.packages(ask = FALSE)'

    - r: release
      script:
        - R CMD build . --compact-vignettes=gs+qpdf
        - R CMD check *tar.gz --as-cran
      before_install:
        - sudo apt-get update
        - tlmgr install index
      after_success:
        - Rscript -e 'covr::codecov(type = "all")'
      warnings_are_errors: true

    - os: osx
      warnings_are_errors: true
